mvp.wearingcash.it {
  encode gzip

  # âœ… Content Security Policy (necessaria per camera + QR scanner)
  header {
    Content-Security-Policy "
      default-src 'self';
      script-src 'self' 'unsafe-eval' https://unpkg.com https://cdn.jsdelivr.net;
      worker-src 'self' blob:;
      img-src 'self' data: blob:;
      media-src 'self' blob:;
      connect-src 'self' blob:;
    "
    Referrer-Policy "strict-origin-when-cross-origin"
    X-Content-Type-Options "nosniff"
    X-Frame-Options "DENY"
    X-XSS-Protection "1; mode=block"
  }

  handle_path /api/* {
    reverse_proxy backend:3000
  }

  handle {
    reverse_proxy frontend:80
  }
}
